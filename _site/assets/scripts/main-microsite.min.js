"use strict";function getPrimaryStats(e){var t="http://osmstats.redcross.org/countries/"+e;$.getJSON(t,function(e){if(null!==e.all_edits){var t=Math.round(e.contributors),a=Math.round(e.all_edits),n=Math.round(e.building_count_add),r=Math.round(e.road_count_add);$("#stats-roadCount").html(r.toLocaleString()),$("#stats-buildingCount").html(n.toLocaleString()),$("#stats-usersCount").html(t.toLocaleString()),$("#stats-editsCount").html(a.toLocaleString())}else $(".emphasizedNumber").css("display","none")})}function getProjects(e){$(".Projects-slider").flexslider({animation:"slide",directionNav:!0,slideshowSpeed:6e6,prevText:"",nextText:'<i class="fa fa-caret-right" aria-hidden="true"></i>'}),$(".flex-next").prependTo(".HOT-Nav-Projects"),$(".flex-control-nav").prependTo(".HOT-Nav-Projects"),$(".flex-prev").prependTo(".HOT-Nav-Projects"),e.length>0?(1===e.length&&$(".flex-next").css("display","none"),e.forEach(function(e,t){var a="http://tasks.hotosm.org/project/"+e+".json";$.getJSON(a,function(e){e.geometry&&makeProject(e,t+2)}).fail(function(n){console.warn("WARNING >> Project #"+e.id+" could not be accessed at "+a+".\nThe server returned the following message object:",n),makePlaceholderProject(e,t+2)})})):makeNoTasksPlaceholder()}function makeProject(e,t){var a=e.properties,n=Math.round(a.done+a.validated);$("#Project-"+e.id+" .HOT-Progress").addClass("projWidth"+t),$("#Project-"+e.id+" .HOT-Title p").html("<b>"+e.id+" - "+a.name+"</b>"),$("#Project-"+e.id+" .HOT-Progress").html("<p>"+n+"%</p>"),$("#Project-"+e.id+" .HOT-Map").attr("id","Map-"+e.id),$("#Project-"+e.id+" .HOT-Progress").append("<style>.projWidth"+t+":before{ width: "+n+"%;}</style>"),addMap(e.id)}function makePlaceholderProject(e,t){$("#Project-"+e+" .HOT-Title p").html('<i class="fa fa-exclamation-triangle" aria-hidden="true"></i>\n<b>HOT Project #'+e+" Not Active/Not Found in HOT Tasking Manager</b>"),$("#TM-Contribute-Btn-"+e).css("display","none"),$("#HOT-Title-"+e+" p").css("width","100%");var a="HOT Tasking Manager endpoint failure in "+PT.name+" country page",n="Project "+e+" is no longer indexed in the HOT\n Tasking Manager, so it should be removed from the "+PT.name+" partner\n page variable settings.",r='Uh oh, it looks like <a href="http://tasks.hotosm.org/project/'+e+'"\n target="_blank">Project #'+e+'</a> has been removed from the HOT Tasking Manager.\n <a href="https://github.com/MissingMaps/partners/issues/new?title='+a+"&body="+n+'" target="_blank">Click here</a> to report an issue or\n <a href="http://tasks.hotosm.org/" target="_blank">here</a>\n to search for more projects.';$("#Project-"+e+"_clone .HOT-Description p").html(r),$("#Project-"+e+" .HOT-Map").empty().addClass("placeholder"),$("#Project-"+e+" .HOT-Progress ").css("display","none"),$("#Project-"+e+" .HOT-Description").css("display","none")}function makeNoTasksPlaceholder(){var e=['<li style="list-style: none" id = Project-NONE>','<div class = "HOT-Container">','<div class = "HOT-Map placeholder">',"</div>",'<div class = "HOT-Details">','<div class = "HOT-Title" id = "HOT-Title-NONE">',"<h2><b>There currently are no tasks for this country.</b></h2>","</div>",'<p><b></b></p><a href="http://tasks.hotosm.org/" class="btn btn-blue" id="TM-Contribute-Btn">FIND OTHER TASKS</a></p>',"</div>","</div>","</li>"];$(".Projects-Container-Leftside").append(e.join(""))}function onEachFeature(e,t){var a={color:"black",weight:.25,opacity:.7,fillOpacity:.4,fillColor:"black"},n=e.properties.state;-1===n?a.fillColor="#dfdfdf":0===n?a.fillColor="#dfdfdf":1===n?a.fillColor="#dfdfdf":2===n?a.fillColor="#ffa500":3===n&&(a.fillColor="#008000"),t.setStyle(a)}function addMap(e){var t="http://tasks.hotosm.org/project/"+e+"/tasks.json";$.getJSON(t,function(t){$("#Map-"+e).empty();var a=L.map("Map-"+e,{zoomControl:!1}).setView([38.889931,-77.009003],13);L.tileLayer(mbBasemapUrl+"?access_token="+mbToken,{attribution:'<a href="http://mapbox.com">Mapbox</a>'}).addTo(a),a.attributionControl.setPrefix("");var n=L.geoJson(t,{onEachFeature:onEachFeature}).addTo(a);a.fitBounds(n.getBounds()),a.dragging.disable(),a.touchZoom.disable(),a.doubleClickZoom.disable(),a.scrollWheelZoom.disable(),a.keyboard.disable(),a.tap&&a.tap.disable()})}function eventsFunctionality(){var e=$(".event-sub-container").length,t=!1,a=!1;3>=e&&$(".events-btn").css("display","none"),$(".events-btn").bind("click").click(function(n){t===!1&&a===!1?(t=!0,$(".hidden").slice(0,2).css("display","block").animate({opacity:1,height:"190px"},500),e>=5?$(".events-btn").html("SEE ALL"):(t=!1,a=!0,$(".events-btn").html("SEE FEWER"))):t===!0&&a===!1&&e>2?(t=!1,a=!0,$(".events-btn").html("SEE ALL"),$(".hidden").css("display","block").animate({opacity:1,height:"190px"},500),$(".events-btn").html("SEE FEWER")):t===!1&&a===!0&&(t=!1,a=!1,$(".hidden").animate({opacity:0,height:"0px"},300,function(){$(".hidden").css("display","none")}),$(".events-btn").html("SEE MORE"))})}function generateEvents(e){if(e.match(/google/)){$("#events-spinner").css("display","block");var t="http://osmstats.redcross.org/calendar/"+e+"/events",a=new Date;$.getJSON(t,function(e){if(0===e.length)$(".events-null").css("display","block"),$(".events-panel").css("display","none");else{var t=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi;console.log(e),Object.keys(e).reverse().map(function(n,r){var s=e[n].time[0];if(moment(a).isBefore(s)){var o=e[n].name,i=e[n].description.match(t),l=e[n].description.replace(t,""),c=e[n].location,d=moment(e[n].time[0]).format("MMMM Do"),p=e[n].time.map(function(e){var t=new Date(e);return moment(t).format("h:mma")}).join(" - "),h=['<div class="card-divider event-top-section">','<div class="sub-head">','<img class="event-images" src="/assets/graphics/flags/4x3/'+PT.flag+'" width="24"/>','<h3 class="event-header">'+o+"</h3>",'<a class="btn btn-grn" href='+i+' target="">SIGN UP</a>',"</div>","</div>"].join(""),u=['<div class="textbox" style="padding-top:8px">',"<p><b>Date:</b> "+d+"</p>","<p><b>Time:</b> "+p+"</p>","<p><b>Location:</b> "+c+"</p>","<p><b>About:</b> "+l+"</p>","</div>"].join(""),m=['<div class="column">','<div class="card">',h,'<div class="card-section">',u,"</div>","</div>","</div>"].join("");$("#event-cards").append(m),$("#events-spinner").css("display","none")}})}})}else $(".events-null").css("display","block"),$(".events-panel").css("display","none");eventsFunctionality()}function setupGraphs(){function e(){var e=document.querySelector("#Team-User-Total-Graph svg"),t=document.querySelector("#Team-User-Bldng-Graph svg"),a=document.querySelector("#Team-User-Roads-Graph svg");e.parentNode.removeChild(e),t.parentNode.removeChild(t),a.parentNode.removeChild(a)}var t=($(".btn.invert-btn-grn.teams-btn"),$(".Team-Graph-Title .left")),a=$(".Team-User-Graph-Title .left");$("#Select-Users-Graph").click(function(){$("#Select-Teams-Graph").removeClass("Selected"),$("#Select-Users-Graph").addClass("Selected"),t.text("Users"),a.text("Users"),e(),getUserActivityStats(PT.code)}),$("#Select-Teams-Graph").click(function(){$("#Select-Users-Graph").removeClass("Selected"),$("#Select-Teams-Graph").addClass("Selected"),t.text("Teams"),a.text("Teams"),e(),getGroupActivityStats(PT.code),showMoreContributions()})}function generateUserUrl(e){var t="http://www.missingmaps.org/users/#/"+e.replace(/\s+/g,"-").toLowerCase();return'<a xlink:href="'+t+'" target="_blank" style="text-decoration:none">'+e+"</a>"}function getUserActivityStats(e){var t="http://osmstats.redcross.org/countries/"+e+"/users";$.getJSON(t,function(e){if(0!==e.length){var t=Object.keys(e).map(function(t){var a=Math.round(Number(e[t].all_edits));return{name:generateUserUrl(e[t].name),value:a}}).sort(function(e,t){return t.value-e.value}),a=Object.keys(e).map(function(t){var a=Math.round(Number(e[t].building_count_add));return{name:generateUserUrl(e[t].name),value:a}}).sort(function(e,t){return t.value-e.value}),n=Object.keys(e).map(function(t){var a=Math.round(Number(e[t].road_km_add));return{name:generateUserUrl(e[t].name),value:a}}).sort(function(e,t){return t.value-e.value}),r=new Barchart(t,"#Team-User-Total-Graph"),s=new Barchart(a,"#Team-User-Bldng-Graph"),o=new Barchart(n,"#Team-User-Roads-Graph"),i=$(".btn.invert-btn-grn.teams-btn");t.length>10?i.css("display","inline").animate({opacity:1},500):i.css("display","inline").animate({opacity:0},500),d3.select(window).on("resize",function(){r.resize(),s.resize(),o.resize()})}})}function generateHashtagUrl(e){var t="http://www.missingmaps.org/leaderboards/#/"+e;return'<a xlink:href="'+t+'" target="_blank" style="text-decoration: none">#'+e+"</a>"}function getGroupActivityStats(e){var t="http://osmstats.redcross.org/countries/"+e+"/hashtags";$.getJSON(t,function(e){if(0!==e.length){var t=e.reduce(function(e,t){if(!$.isEmptyObject(t)){var a=Math.round(Number(t.all_edits));e.push({name:generateHashtagUrl(t.hashtag),value:a})}return e},[]).sort(function(e,t){return t.value-e.value}),a=e.reduce(function(e,t){if(!$.isEmptyObject(t)){var a=Math.round(Number(t.building_count_add))+Math.round(Number(t.building_count_mod));e.push({name:generateHashtagUrl(t.hashtag),value:a})}return e},[]).sort(function(e,t){return t.value-e.value}),n=e.reduce(function(e,t){if(!$.isEmptyObject(t)){var a=Math.round(Number(t.road_km_add))+Math.round(Number(t.road_km_add));e.push({name:generateHashtagUrl(t.hashtag),value:a})}return e},[]).sort(function(e,t){return t.value-e.value}),r=new Barchart(t,"#Team-User-Total-Graph"),s=new Barchart(a,"#Team-User-Bldng-Graph"),o=new Barchart(n,"#Team-User-Roads-Graph"),i=$(".btn.invert-btn-grn.teams-btn");t.length>10?i.css("display","inline").animate({opacity:1},500):i.css("display","inline").animate({opacity:0},500),d3.select(window).on("resize",function(){r.resize(),s.resize(),o.resize()})}else $(".Team-User-Nav").css("display","none"),$(".Team-User-Stats").css("display","none"),$(".teams-more").css("display","none"),$(".teams-none").css("display","block"),$(".Team-User-Container h1").css("text-align","center")})}function Barchart(e,t){var a={top:0,right:0,bottom:0,left:0},n=parseInt(d3.select(t).style("width"),10);n=n-a.left-a.right;var r=220,s=60/e.length,o=(r-a.top-a.bottom)/e.length-s;if(e.length>10){s=6,o=(r-a.top-a.bottom)/10-s,r+=(s+o)*(e.length-10);var i=-((e.length-10)*(s+o))-12,l=!1;$(".teams-btn").css("display","initial").click(function(){var e=$(".Team-User-Graph > svg");l===!1?($(".teams-btn").html("SHOW INITIAL TEAMS"),e.animate({marginTop:i},300),l=!0):l===!0&&($(".teams-btn").html("SHOW MORE TEAMS"),e.animate({marginTop:0},300),l=!1)})}var c=d3.scale.linear().range([0,n]).domain([0,d3.max(e,function(e){return e.value})]),d=d3.select(t).append("svg").style("width",n+a.left+a.right+"px").style("height",r+"px").append("g").attr("transform","translate("+[a.left,a.top]+")");d3.select(d.node().parentNode).style("height",r+"px");var p=d.selectAll(".bar").data(e).enter().append("g").attr("class","bar").attr("transform",function(e,t){return"translate(0,"+t*(o+s)+")"});p.append("rect").attr("class","bars").attr("height",o).attr("width",function(e){return c(e.value)}),p.append("text").attr("class","Graph-Label-Name").attr("x",5).attr("y",o/2).attr("dy",".35em").html(function(e){return e.name}).style("fill","#606161"),p.append("text").attr("class","Graph-Label-Value").attr("x",n-20).attr("y",o/2).attr("dy",".35em").text(function(e){return e.value.toLocaleString()}).attr("text-anchor","end").style("fill","#606161"),this.resize=function(){n=parseInt(d3.select(t).style("width"),10),n=n-a.left-a.right,d3.select(t).select("svg").style("width",n+a.left+a.right+"px"),c.range([0,n]),d.selectAll("rect.bars").attr("width",function(e){return c(e.value)}),d.selectAll("text.Graph-Label-Value").attr("x",n-20)}}function showUpdatesPlaceholder(){0===$(".Updates-Content").length&&($(".updates-null").css("display","block"),$("#updates-h1").css("text-align","center"))}var mbToken="pk.eyJ1IjoiZGV2c2VlZCIsImEiOiJnUi1mbkVvIn0.018aLhX0Mb0tdtaT2QNe2Q",mbBasemapUrl="https://api.mapbox.com/v4/mapbox.light/{z}/{x}/{y}.png";"Microsites"!==PT.name&&(showUpdatesPlaceholder(),getPrimaryStats(PT.code),getGroupActivityStats(PT.code),getProjects(PT.hotProjects),generateEvents(PT.calendar),setupGraphs());
//# sourceMappingURL=maps/main-5364abc979.js.map